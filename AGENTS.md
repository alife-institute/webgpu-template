# Project-specific AI guidance

## Build and Development Workflow

### Build Process

This project uses Webpack to build TypeScript and WGSL shaders into a static HTML application:

```bash
npm run build    # Build to dist/
```

**Important**: The final output is a **static HTML file** at `dist/index.html`, along with bundled JavaScript.

### File Structure

```
src/
├── index.ts              # Main entry point
├── utils.ts              # WebGPU utilities
├── index.html            # HTML template (processed by webpack)
└── shaders/
    ├── compute.wgsl      # Compute shader
    └── render.wgsl       # Render shader (vertex + fragment)

dist/                     # Built output (generated by webpack)
├── index.html            # Final HTML (includes bundled scripts)
├── index.bundle.js       # Bundled application code
└── runtime.bundle.js     # Webpack runtime
```

## Testing and Validation

### Automated Capture Tool

After making code changes, use the capture tool to verify the simulation works:

```bash
npm run build
npm run capture
```

Check `.capture/session-[timestamp]/` for results
**What gets captured**:

- Console output (logs, warnings, errors)
- Multiple screenshots showing animation over time
- JSON summary with error analysis

**Output location**: `.capture/session-[timestamp]/`

### When to Use Capture Tool

**Always capture after**:

- Modifying shaders (compute.wgsl, render.wgsl)
- Changing simulation logic (index.ts)
- Updating WebGPU initialization (utils.ts)
- Making any code changes that affect rendering

**Why**: The capture tool runs in a real Chrome browser with WebGPU support, catching:

- Shader compilation errors
- WebGPU API usage errors
- Runtime errors that don't show up during build
- Visual verification that the simulation actually renders

### Expected Console Output

A healthy simulation should show:

```
✓ [INFO] [webpack-dev-server] Server started...
✓ [LOG] [HMR] Waiting for update signal from WDS...
✓ [INFO] WebGPU is experimental on this platform...
```

**Common errors to watch for**:

- `Failed to load resource: 404` - Wrong URL or missing file
- `Shader compilation failed` - WGSL syntax errors
- `WebGPU not supported` - Browser compatibility issue
- `TypeError` - JavaScript errors in your code

### WebGPU Screenshot and Console Capture

**The capture tool opens a visible browser by default** so WebGPU screenshots work correctly:

- Opens `dist/index.html` directly using `file://` protocol
- No dev server needed
- Screenshots capture the actual rendered output
- Console logs are also captured for debugging

**Note**: WebGPU does not render in headless Chrome, so screenshots would be black in headless mode. The default non-headless mode ensures screenshots work out of the box.

### Verifying Captures

```bash
# Check console logs for errors
cat .capture/session-*/console.log

# View error summary as JSON
jq '.errors' .capture/session-*/summary.json

# View screenshots (in any image viewer)
open .capture/session-*/frame-0002.png
```

### Development Server

This is typically used by human for debugging sessions and visualising hot-reloaded code changes

```bash
npm start # hot-reload on localhost:5500
```

**Do NOT run `npm start`** - The development server is for human interactive debugging and visualization only. The capture tool provides everything needed for automated validation.
